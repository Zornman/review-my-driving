
<div class="bf-page">
    <header class="bf-header">
        <div class="bf-header__text">
            <h3 class="bf-title">Business Settings</h3>
            <p class="bf-subtitle">Manage business info, notifications, and daily report scheduling.</p>
        </div>
    </header>

    <div class="container bf-container">
        <div class="row">
            <div class="col-12">
                <form [formGroup]="businessUserForm" class="bf-form">
                    <section class="bf-section">
                        <div class="bf-section__header">
                            <h3 class="bf-section__title">Business Info</h3>
                            <p class="bf-section__subtitle">Contact details and business identity.</p>
                        </div>
                        <div class="bf-section__body">
                            <div class="row g-3">
                                <div class="col-12 col-md-4">
                                    <mat-form-field appearance="outline">
                                        <mat-label>User ID</mat-label>
                                        <input matInput formControlName="userId" name="userId">
                                    </mat-form-field>
                                </div>
                                <div class="col-12 col-md-8">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Business Name</mat-label>
                                        <input matInput formControlName="businessName" name="businessName">
                                        <mat-error *ngIf="businessUserForm.get('businessName')?.hasError('required') && businessUserForm.get('businessName')?.touched">
                                            Business name is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div class="col-12 col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>E-Mail</mat-label>
                                        <input matInput type="email" formControlName="contactEmail" name="contactEmail">
                                        <mat-error *ngIf="businessUserForm.get('contactEmail')?.hasError('required') && businessUserForm.get('contactEmail')?.touched">
                                            Email is required
                                        </mat-error>
                                        <mat-error *ngIf="businessUserForm.get('contactEmail')?.hasError('email') && businessUserForm.get('contactEmail')?.touched">
                                            Enter a valid email
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div class="col-12 col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Phone</mat-label>
                                        <input matInput type="tel" formatPhone formControlName="contactPhone" name="contactPhone">
                                        <mat-error *ngIf="businessUserForm.get('contactPhone')?.hasError('required') && businessUserForm.get('contactPhone')?.touched">
                                            Phone is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="bf-section">
                        <div class="bf-section__header">
                            <h3 class="bf-section__title">Notifications</h3>
                            <p class="bf-section__subtitle">Control when you receive emails and alerts.</p>
                        </div>
                        <div class="bf-section__body">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Notify On New Review</mat-label>
                                        <mat-select formControlName="notifyOnNewReview" name="notifyOnNewReview">
                                            <mat-option [value]="true">Yes</mat-option>
                                            <mat-option [value]="false">No</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="businessUserForm.get('notifyOnNewReview')?.hasError('required') && businessUserForm.get('notifyOnNewReview')?.touched">
                                            This field is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <div class="col-12 col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Daily Summary Email</mat-label>
                                        <mat-select formControlName="dailySummaryEmail" name="dailySummaryEmail">
                                            <mat-option [value]="true">Yes</mat-option>
                                            <mat-option [value]="false">No</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="businessUserForm.get('dailySummaryEmail')?.hasError('required') && businessUserForm.get('dailySummaryEmail')?.touched">
                                            This field is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="bf-section">
                        <div class="bf-section__header">
                            <h3 class="bf-section__title">Daily Reports</h3>
                            <p class="bf-section__subtitle">Enable and configure daily report windows.</p>
                        </div>
                        <div class="bf-section__body">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Daily Reports Enabled</mat-label>
                                        <mat-select formControlName="dailyReportsEnabled" name="dailyReportsEnabled">
                                            <mat-option [value]="true">Yes</mat-option>
                                            <mat-option [value]="false">No</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="businessUserForm.get('dailyReportsEnabled')?.hasError('required') && businessUserForm.get('dailyReportsEnabled')?.touched">
                                            This field is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="bf-separator" *ngIf="isDailyReportsEnabled"></div>

                            <ng-container *ngIf="isDailyReportsEnabled">
                                <div class="bf-schedule">
                                    <div class="bf-schedule__title">Operating Schedule</div>
                                    <div class="bf-schedule__hint">Daily report emails only send on selected operating days, excluding configured holidays.</div>

                                    <div class="bf-days" formGroupName="operatingDays">
                                        <button
                                            type="button"
                                            class="bf-day"
                                            *ngFor="let d of operatingDayOptions"
                                            [class.is-selected]="businessUserForm.get('operatingDays.' + d.key)?.value"
                                            (click)="toggleOperatingDay(d.key)"
                                            [attr.aria-pressed]="businessUserForm.get('operatingDays.' + d.key)?.value"
                                            [attr.aria-label]="d.aria"
                                        >
                                            {{ d.label }}
                                        </button>
                                    </div>

                                    <div class="row g-3 mt-2">
                                        <div class="col-12 col-md-4">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Holidays</mat-label>
                                                <mat-select formControlName="holidayMode" name="holidayMode">
                                                    <mat-option [value]="'none'">Send on holidays</mat-option>
                                                    <mat-option [value]="'custom'">Skip custom dates</mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                        <div class="col-12 col-md-8">
                                            <mat-form-field appearance="outline">
                                                <mat-label>Holiday dates (YYYY-MM-DD)</mat-label>
                                                <textarea matInput rows="3" formControlName="holidayDates" name="holidayDates" placeholder="2026-01-01\n2026-12-25"></textarea>
                                                <mat-hint>One per line. Dates are interpreted in the business timezone.</mat-hint>
                                                <mat-error *ngIf="businessUserForm.get('holidayDates')?.hasError('holidayDates')">Enter one date per line, like 2026-12-25.</mat-error>
                                            </mat-form-field>
                                        </div>
                                    </div>

                                    <div class="bf-separator"></div>
                                </div>

                                <div class="row g-3 mt-0">
                                    <div class="col-12 col-md-4">
                                        <mat-form-field appearance="outline">
                                            <mat-label>Start Time</mat-label>
                                            <input matInput formControlName="dailyReportsStartTime" name="dailyReportsStartTime">
                                            <mat-hint>24-hour format (e.g., 14:30)</mat-hint>
                                            <mat-error *ngIf="businessUserForm.get('dailyReportsStartTime')?.hasError('required') && businessUserForm.get('dailyReportsStartTime')?.touched">
                                                Start time is required
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <mat-form-field appearance="outline">
                                            <mat-label>End Time</mat-label>
                                            <input matInput formControlName="dailyReportsEndTime" name="dailyReportsEndTime">
                                            <mat-hint>24-hour format (e.g., 18:00)</mat-hint>
                                            <mat-error *ngIf="businessUserForm.get('dailyReportsEndTime')?.hasError('required') && businessUserForm.get('dailyReportsEndTime')?.touched">
                                                End time is required
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <mat-form-field appearance="outline">
                                            <mat-label>Timezone</mat-label>
                                            <mat-select formControlName="timezone" name="timezone">
                                                <mat-option *ngFor="let tz of timezones" [value]="tz.value">{{ tz.name }}</mat-option>
                                            </mat-select>
                                            <mat-hint>Used for scheduling</mat-hint>
                                            <mat-error *ngIf="businessUserForm.get('timezone')?.hasError('required') && businessUserForm.get('timezone')?.touched">
                                                Timezone is required
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </section>

                    <section class="bf-section">
                        <div class="bf-section__header">
                            <h3 class="bf-section__title">Metadata</h3>
                            <p class="bf-section__subtitle">Read-only timestamps for auditing.</p>
                        </div>
                        <div class="bf-section__body">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Last Updated</mat-label>
                                        <input matInput formControlName="updatedAt" name="updatedAt" [disabled]="true">
                                    </mat-form-field>
                                </div>
                                <div class="col-12 col-md-6">
                                    <mat-form-field appearance="outline">
                                        <mat-label>Created Date</mat-label>
                                        <input matInput formControlName="createdAt" name="createdAt" [disabled]="true">
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </section>

                    <div class="bf-actions">
                        <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="businessUserForm.invalid || isLoading || !hasUnsavedChanges">
                            Save Changes
                            <mat-progress-spinner *ngIf="isLoading" mode="indeterminate" diameter="20" class="bf-actions__spinner"></mat-progress-spinner>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>