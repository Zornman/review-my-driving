"use strict";exports.id=946,exports.ids=[946],exports.modules={7946:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ProductPageComponent:()=>ProductPageComponent});var asyncToGenerator=__webpack_require__(467),core=__webpack_require__(4580),product=__webpack_require__(4447),common=__webpack_require__(7514),http=__webpack_require__(846);const _c0=["carouselTrack"];function CarouselComponent_img_3_Template(rf,ctx){1&rf&&core.nrm(0,"img",6),2&rf&&core.Y8G("src",ctx.$implicit.src,core.B4B)}let CarouselComponent=(()=>{class CarouselComponent2{platformId;images;carouselTrack;currentIndex=0;track;constructor(platformId){this.platformId=platformId}ngOnInit(){(0,common.UE)(this.platformId)&&(this.track=document.querySelector(".carousel-track"),this.track||console.error("Carousel track not found"))}ngAfterViewInit(){(0,common.UE)(this.platformId)&&(this.track=this.carouselTrack.nativeElement,this.track?this.updateCarousel():console.error("Carousel track not found"))}next(){(0,common.UE)(this.platformId)&&this.track&&this.currentIndex<this.track.children.length-1&&(this.currentIndex++,this.updateCarousel())}prev(){(0,common.UE)(this.platformId)&&this.track&&this.currentIndex>0&&(this.currentIndex--,this.updateCarousel())}updateCarousel(){(0,common.UE)(this.platformId)&&this.track&&this.images?.length&&(this.track.style.transform=`translateX(-${this.currentIndex*this.track.clientWidth}px)`)}static \u0275fac=function(__ngFactoryType__){return new(__ngFactoryType__||CarouselComponent2)(core.rXU(core.Agw))};static \u0275cmp=core.VBU({type:CarouselComponent2,selectors:[["app-carousel"]],viewQuery:function(rf,ctx){if(1&rf&&core.GBs(_c0,5),2&rf){let _t;core.mGM(_t=core.lsd())&&(ctx.carouselTrack=_t.first)}},inputs:{images:"images"},decls:8,vars:1,consts:[["carouselTrack",""],[1,"carousel"],[1,"carousel-track"],["class","carousel-image",3,"src",4,"ngFor","ngForOf"],[1,"carousel-button","prev",3,"click"],[1,"carousel-button","next",3,"click"],[1,"carousel-image",3,"src"]],template:function(rf,ctx){if(1&rf){const _r1=core.RV6();core.j41(0,"div",1)(1,"div",2,0),core.DNE(3,CarouselComponent_img_3_Template,1,1,"img",3),core.k0s(),core.j41(4,"button",4),core.bIt("click",function(){return core.eBV(_r1),core.Njj(ctx.prev())}),core.EFF(5,"\u2039"),core.k0s(),core.j41(6,"button",5),core.bIt("click",function(){return core.eBV(_r1),core.Njj(ctx.next())}),core.EFF(7,"\u203a"),core.k0s()()}2&rf&&(core.R7$(3),core.Y8G("ngForOf",ctx.images))},dependencies:[common.MD,common.Sq],encapsulation:2})}return CarouselComponent2})();var form_field=__webpack_require__(4520),fesm2022_select=__webpack_require__(8185),input=__webpack_require__(8403),fesm2022_button=__webpack_require__(1397),fesm2022_forms=__webpack_require__(3054),dialog=__webpack_require__(9121),router=__webpack_require__(8134);let SignUpDialogComponent=(()=>{class SignUpDialogComponent2{dialogRef;router;constructor(dialogRef,router2){this.dialogRef=dialogRef,this.router=router2}signUp(){this.router.navigate(["/register"]),this.dialogRef.close()}static \u0275fac=function(__ngFactoryType__){return new(__ngFactoryType__||SignUpDialogComponent2)(core.rXU(dialog.CP),core.rXU(router.Ix))};static \u0275cmp=core.VBU({type:SignUpDialogComponent2,selectors:[["app-sign-up-dialog"]],decls:10,vars:0,consts:[["mat-dialog-title",""],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary",3,"click"]],template:function(rf,ctx){1&rf&&(core.j41(0,"h2",0),core.EFF(1,"Sign Up"),core.k0s(),core.j41(2,"mat-dialog-content")(3,"span"),core.EFF(4,"Please sign in before adding any items to your cart to ensure we can customize them for you!"),core.k0s()(),core.j41(5,"mat-dialog-actions",1)(6,"button",2),core.EFF(7,"Cancel"),core.k0s(),core.j41(8,"button",3),core.bIt("click",function(){return ctx.signUp()}),core.EFF(9,"Sign Up"),core.k0s()())},dependencies:[dialog.hM,dialog.tx,dialog.BI,dialog.E7,dialog.Yi],encapsulation:2})}return SignUpDialogComponent2})();var snack_bar=__webpack_require__(4513),platform_browser=__webpack_require__(410),shopping_cart_service=__webpack_require__(5702),auth_service=__webpack_require__(5766);let QRCodeService=(()=>{class QRCodeService2{authService;baseURL="https://www.reviewmydriving.co/";userID;QRCode;constructor(authService){this.authService=authService,this.loadQRCodeModule(),this.authService.getUser().subscribe(user=>{user&&(this.userID=user.uid)})}loadQRCodeModule(){var _this=this;return(0,asyncToGenerator.A)(function*(){_this.QRCode=(yield __webpack_require__.e(561).then(__webpack_require__.t.bind(__webpack_require__,2561,19))).default})()}generateQRCode(){var _this2=this;return(0,asyncToGenerator.A)(function*(){const url=`${_this2.baseURL}home?id=${_this2.userID}`;try{const options={width:3e3,errorCorrectionLevel:"H"};return yield _this2.QRCode.toDataURL(url,options)}catch(err){throw console.error("Error generating QR code:",err),err}})()}static \u0275fac=function(__ngFactoryType__){return new(__ngFactoryType__||QRCodeService2)(core.KVO(auth_service.u))};static \u0275prov=core.jDH({token:QRCodeService2,factory:QRCodeService2.\u0275fac,providedIn:"root"})}return QRCodeService2})();var printify_service=__webpack_require__(3852),mongo_service=__webpack_require__(8245),fesm2022_core=__webpack_require__(692);function ProductPageComponent_div_8_p_6_Template(rf,ctx){1&rf&&(core.j41(0,"p"),core.EFF(1,"Note: Sign up to ensure any QR codes are linked to you."),core.k0s())}function ProductPageComponent_div_8_mat_option_12_Template(rf,ctx){if(1&rf&&(core.j41(0,"mat-option",18),core.EFF(1),core.k0s()),2&rf){const variant_r4=ctx.$implicit;core.Y8G("value",variant_r4.id),core.R7$(),core.Lme(" ",variant_r4.title.split("/")[0]," - $",(variant_r4.price/100).toFixed(2)," ")}}function ProductPageComponent_div_8_mat_option_18_Template(rf,ctx){if(1&rf&&(core.j41(0,"mat-option",18),core.EFF(1),core.k0s()),2&rf){const q_r5=ctx.$implicit;core.Y8G("value",q_r5),core.R7$(),core.JRh(q_r5)}}function ProductPageComponent_div_8_img_22_Template(rf,ctx){if(1&rf&&core.nrm(0,"img",19),2&rf){const ctx_r2=core.XpG(2);core.Y8G("src",ctx_r2.imageFile,core.B4B)}}function ProductPageComponent_div_8_Template(rf,ctx){if(1&rf){const _r2=core.RV6();core.j41(0,"div",5)(1,"div",3)(2,"div",8)(3,"h1"),core.EFF(4),core.k0s(),core.nrm(5,"span",9),core.DNE(6,ProductPageComponent_div_8_p_6_Template,2,0,"p",10),core.k0s()(),core.j41(7,"div",11)(8,"mat-form-field",12)(9,"mat-label"),core.EFF(10,"Choose a variant"),core.k0s(),core.j41(11,"mat-select",13),core.mxI("valueChange",function($event){core.eBV(_r2);const ctx_r2=core.XpG();return core.DH7(ctx_r2.selectedVariant,$event)||(ctx_r2.selectedVariant=$event),core.Njj($event)}),core.DNE(12,ProductPageComponent_div_8_mat_option_12_Template,2,3,"mat-option",14),core.k0s()()(),core.j41(13,"div",11)(14,"mat-form-field",15)(15,"mat-label"),core.EFF(16,"Quantity"),core.k0s(),core.j41(17,"mat-select",13),core.mxI("valueChange",function($event){core.eBV(_r2);const ctx_r2=core.XpG();return core.DH7(ctx_r2.quantity,$event)||(ctx_r2.quantity=$event),core.Njj($event)}),core.DNE(18,ProductPageComponent_div_8_mat_option_18_Template,2,2,"mat-option",14),core.k0s()()(),core.j41(19,"div",11)(20,"button",16),core.bIt("click",function(){core.eBV(_r2);const ctx_r2=core.XpG();return core.Njj(ctx_r2.addToCart())}),core.EFF(21," Add to Cart "),core.k0s(),core.DNE(22,ProductPageComponent_div_8_img_22_Template,1,1,"img",17),core.k0s()()}if(2&rf){const ctx_r2=core.XpG();core.R7$(4),core.JRh(ctx_r2.product.title),core.R7$(),core.Y8G("innerHTML",ctx_r2.productDescription,core.npT),core.R7$(),core.Y8G("ngIf",!ctx_r2.user),core.R7$(5),core.R50("value",ctx_r2.selectedVariant),core.R7$(),core.Y8G("ngForOf",ctx_r2.productVariants),core.R7$(5),core.R50("value",ctx_r2.quantity),core.R7$(),core.Y8G("ngForOf",ctx_r2.quantities),core.R7$(2),core.Y8G("disabled",ctx_r2.isAddDisabled()||ctx_r2.disableAdd),core.R7$(2),core.Y8G("ngIf",ctx_r2.imageFile)}}function ProductPageComponent_ng_template_9_Template(rf,ctx){1&rf&&(core.j41(0,"p"),core.EFF(1,"Product not found."),core.k0s())}let ProductPageComponent=(()=>{class ProductPageComponent2{route;router;sanitizer;cartService;authService;dialog;qrCodeService;printifyService;dbService;_snackBar=(0,core.WQX)(snack_bar.UG);product;product_custom;productDescription;productImages=[];productVariants=[];loading=!0;selectedVariant;quantity;quantities=Array.from({length:10},(_,i)=>i+1);user;imageFile;disableAdd=!1;constructor(route,router2,sanitizer,cartService,authService,dialog2,qrCodeService,printifyService,dbService){this.route=route,this.router=router2,this.sanitizer=sanitizer,this.cartService=cartService,this.authService=authService,this.dialog=dialog2,this.qrCodeService=qrCodeService,this.printifyService=printifyService,this.dbService=dbService,this.authService.getUser().subscribe(user=>{this.user=user})}ngOnInit(){const navigation=this.router.getCurrentNavigation();if(this.product=navigation?.extras.state?.product||null,!this.product){this._snackBar.open("Loading product details...");const productId=this.route.snapshot.paramMap.get("id");productId?this.printifyService.getProduct(productId).subscribe({next:response=>{this.product=response,this.productImages=this.product.images,this.productVariants=this.product.variants.filter(variant=>variant.is_enabled),this.productDescription=this.sanitizer.bypassSecurityTrustHtml(this.product.description),this._snackBar.open("Product details loaded!","Ok",{duration:3e3}),this._snackBar.dismiss()},error:error=>{this._snackBar.open("Error loading product details, please try again.","Ok",{duration:3e3}),this.dbService.insertErrorLog({fileName:"product-page.component.ts",method:"ngOnInit()",timestamp:(new Date).toString(),error}).subscribe({next:response=>{console.log(response)},error:error2=>{}})}}):console.error("No product ID provided.")}}isAddDisabled(){return void 0===this.selectedVariant||void 0===this.quantity}backToShop(){this.router.navigateByUrl("/shop")}addToCart(){var _this=this;return(0,asyncToGenerator.A)(function*(){_this.user?yield _this.checkForExistingProduct():_this.openSignUpDialog()})()}checkForExistingProduct(){var _this2=this;return(0,asyncToGenerator.A)(function*(){_this2._snackBar.open("Adding product to your cart..."),_this2.disableAdd=!0,yield _this2.printifyService.getProducts().subscribe({next:response=>{let products=response.data.map(item=>new product.Yt(item));if(_this2.user){const uid=_this2.user?_this2.user.uid:"";products=products.filter(x=>x.title.includes(uid)&&x.title.includes(_this2.product.title)),products.length>0?(_this2.cartService.addToCart({productId:products[0].id,variantId:_this2.selectedVariant,quantity:_this2.quantity,product:products[0]}),_this2._snackBar.open("Product added to cart!","Ok",{duration:3e3}),_this2.disableAdd=!1):_this2.createNewProduct()}},error:error=>{_this2.dbService.insertErrorLog({fileName:"product-page.component.ts",method:"checkForExistingProduct()",timestamp:(new Date).toString(),error}).subscribe({next:response=>{console.log(response)},error:error2=>{}}),_this2.disableAdd=!1}})})()}createNewProduct(){var _this3=this;return(0,asyncToGenerator.A)(function*(){let qr_code;yield _this3.qrCodeService.generateQRCode().then(base64=>{qr_code=base64,qr_code=qr_code.substring(22,base64.length),_this3.printifyService.createCustomPrintifyProduct({base64QRCode:qr_code,originalProductId:_this3.product.id,userID:_this3.user?.uid}).subscribe({next:response=>{_this3.cartService.addToCart({productId:response.product.id,variantId:_this3.selectedVariant,quantity:_this3.quantity,product:response.product}),_this3._snackBar.open("Product added to cart!","Ok",{duration:3e3}),_this3.disableAdd=!1},error:error=>{_this3.dbService.insertErrorLog({fileName:"product-page.component.ts",method:"createNewProduct()",timestamp:(new Date).toString(),error}).subscribe({next:response=>{console.log(response)},error:error2=>{}}),_this3.disableAdd=!1}})})})()}openSignUpDialog(){this.dialog.open(SignUpDialogComponent,{width:"400px",disableClose:!0})}static \u0275fac=function(__ngFactoryType__){return new(__ngFactoryType__||ProductPageComponent2)(core.rXU(router.nX),core.rXU(router.Ix),core.rXU(platform_browser.up),core.rXU(shopping_cart_service.m),core.rXU(auth_service.u),core.rXU(dialog.bZ),core.rXU(QRCodeService),core.rXU(printify_service.T),core.rXU(mongo_service.g))};static \u0275cmp=core.VBU({type:ProductPageComponent2,selectors:[["app-product-page"]],decls:11,vars:2,consts:[["notFound",""],[1,"container"],[1,"row"],[1,"col-xs-12"],[3,"click"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-6"],[3,"images"],["class","col-xs-12 col-sm-12 col-md-12 col-lg-6",4,"ngIf"],[1,"product-detail"],[3,"innerHTML"],[4,"ngIf"],[1,"col-xs-12","col-center"],["appearance","outline",1,"variant-select"],["required","",3,"valueChange","value"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"quantity-select"],["mat-raised-button","","color","primary",3,"click","disabled"],[3,"src",4,"ngIf"],[3,"value"],[3,"src"]],template:function(rf,ctx){if(1&rf){const _r1=core.RV6();core.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"p")(4,"a",4),core.bIt("click",function(){return core.eBV(_r1),core.Njj(ctx.backToShop())}),core.EFF(5,"\u2039 Back"),core.k0s()()(),core.j41(6,"div",5),core.nrm(7,"app-carousel",6),core.k0s(),core.DNE(8,ProductPageComponent_div_8_Template,23,9,"div",7),core.k0s()(),core.DNE(9,ProductPageComponent_ng_template_9_Template,2,0,"ng-template",null,0,core.C5r)}2&rf&&(core.R7$(7),core.Y8G("images",ctx.productImages),core.R7$(),core.Y8G("ngIf",ctx.product))},dependencies:[common.MD,common.Sq,common.bT,http.q1,fesm2022_forms.YN,CarouselComponent,form_field.RG,form_field.rl,form_field.nJ,fesm2022_select.Ve,fesm2022_select.VO,fesm2022_core.wT,input.fS,fesm2022_button.Hl,fesm2022_button.$z],encapsulation:2})}return ProductPageComponent2})()}};